<%= form_with(model: @practice) do |form| %>
  <div class='card w-50'>
    <div class="card-body">
      <!-- Profile picture and short information -->
      <div class="d-flex align-items-center position-relative pb-3">
        <%# if practice.errors.any? %>
        <!--    <div style="color: red">-->
        <!--      <h2><%#= pluralize(practice.errors.count, "error") %> prohibited this practice from being saved:</h2>-->

        <!--      <ul>-->
        <%# practice.errors.each do |error| %>
        <!--          <li><%#= error.full_message %></li>-->
        <%# end %>
        <!--      </ul>-->
        <!--    </div>-->
        <%# end %>
        <!--  <div class="flex-shrink-0">-->
        <!--    <img class="img-md rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="Profile Picture" loading="lazy">-->
        <!--  </div>-->
        <div class="flex-grow-1">
          <% if @practice.show_timer? %>
            <div id="stopwatch">
              <div class="timerDisplay text-center">
                00 : <%= @practice.minutes.to_s.rjust(2, '0') %> : 00 : 000
              </div>
              <div class="buttons text-center">
                <button id="pauseTimer" class="btn btn-success" type="button"><i class="bi bi-pause-circle"></i> Pause</button>
                <button id="startTimer" class="btn btn-primary" type="button"><i class="bi bi-play-circle-fill"></i> Start</button>
                <button id="resetTimer" class="btn btn-danger" type="button"><i class="bi bi-x-circle"></i> Reset</button>
              </div>
            </div>
          <% end %>
          <%= form.label :minutes, class: "form-label" %>
          <%= form.number_field :minutes, class: 'form-control' %>
          <%= form.label :practice_date, class: 'form-label' %>
          <%= form.datetime_field :practice_date, class: 'form-control' %>
        </div>
      </div>
      <%= form.label :notes, class: 'form-label' %>
      <%= form.text_area :notes, class: 'form-control' %>
      <!-- END : Profile picture and short information -->

      <!-- Options buttons -->
      <div class="mt-3 pt-2 text-center border-top">
        <div class="d-flex justify-content-center gap-3">
          <%= form.submit class: "btn btn-sm btn-info btn-outline-light btn-lg" %> <%= link_to "Cancel", practices_path, class: "btn btn-sm btn-info btn-outline-light btn-lg" %>
        </div>
      </div>
      <!-- END : Options buttons -->
    </div>
  </div>

  <% if @practice.show_timer? %>
    <script type='application/javascript'>
      let [milliseconds,seconds,minutes,hours] = [0,0,<%= @practice.minutes %>,0];
      let timerRef = document.querySelector('.timerDisplay');
      let int = null;
      let minutesRef = document.getElementById('practice_minutes');
      document.getElementById('startTimer').addEventListener('click', ()=>{
          if(int!==null){
              clearInterval(int);
          }
          int = setInterval(displayTimer,10);
      });
      document.getElementById('pauseTimer').addEventListener('click', ()=>{
          clearInterval(int);
      });
      document.getElementById('resetTimer').addEventListener('click', ()=>{
          clearInterval(int);
          [milliseconds,seconds,minutes,hours] = [0,0,0,0];
          timerRef.innerHTML = '00 : 00 : 00 : 000 ';
      });
      function displayTimer(){
          milliseconds+=10;
          if(milliseconds == 1000){
              milliseconds = 0;
              seconds++;
              if(seconds == 60){
                  seconds = 0;
                  minutes++;
                  if(minutes == 60){
                      minutes = 0;
                      hours++;
                  }
              }
          }
          let h = hours < 10 ? "0" + hours : hours;
          let m = minutes < 10 ? "0" + minutes : minutes;
          let s = seconds < 10 ? "0" + seconds : seconds;
          let ms = milliseconds < 10 ? "00" + milliseconds : milliseconds < 100 ? "0" + milliseconds : milliseconds;
          timerRef.innerHTML = ` ${h} : ${m} : ${s} : ${ms}`;
          minutesRef.value = minutes;
      }
    </script>
  <% end %>
<% end %>
